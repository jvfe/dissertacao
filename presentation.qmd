---
title: "O Ecossistema Computacional da Metagenômica"
subtitle: "Fluxos de Trabalho e Reprodutibilidade"
author: "João Vitor Cavalcante"
lang: pt
bibliography: refs.bib
csl: diabetologia.csl
format: 
  revealjs:
    theme: "night"
    transition: fade
    slide-number: true
    multiplex: true # audience can follow along w/ mobile devices
    fragments: true
    logo: https://i.imgur.com/ena8fiz.png
    smaller: true
    css: pres_styles.css
---

# Introdução

## Visão Geral - Metagenômica {.smaller}

:::: {.columns}

::: {.column width="45%"}
- A história da vida microscópica, ou microbiana, no planeta Terra supera a história da vida macroscópica por milhares de anos;

- Avanços no que viria eventualmente a se tornar a metagenômica surgem ainda nos anos 90, com o primeiro sequenciamento de genoma completo de um organismo de vida livre, a bactéria Haemophilus influenza;

- No entanto, os primeiros estudos de microbioma tiram proveito da técnica de 16S.
:::

::: {.column width="55%" style="text-align: center;"}
<center>![](https://i.imgur.com/ma0INe4.png){width=1100}</center>
:::

::::

## Visão Geral - Metagenômica {.smaller}

:::: {.columns}

::: {.column width="45%"}
- A técnica do *whole-genome sequencing* possibilitou o sequenciamento
do conteúdo genético total de amostras ambientais, originando a metagenômica *shotgun* (MS);

- A MS gera um alto volume de dados, e portanto, há a necessidade do desenvolvimento de
ferramentas computacionais que processem esses dados e os descreva de 
forma acurada e reproduzível achados acerca do microambiente de estudo.
:::

::: {.column width="55%" style="text-align: center;"}
<center>![](https://i.imgur.com/ma0INe4.png){width=1100}</center>
:::

::::

## As etapas da análise metagenômica {.smaller}

- A análise de dados de metagenômica é realizada de acordo com seu contexto,
mas podemos elencar passos fundamentais a praticamente toda metodologia:
  - Pré-processamento das leituras para controle de qualidade;
    - Pode abarcar descontaminação, caso amostra seja associada a um hospedeiro.
  - Classificação taxonômica;
  - Anotação funcional.

## Desenvolvimento de Software Científico {.smaller}

:::: {.columns}

::: {.column width="50%"}
- Metodologias computacionais constituem parte indissociável da biologia molecular moderna;

- A agregação de ferramentas computacionais em sequência, ou fluxos de trabalho, 
surgem como *softwares* que prezam um método reprodutível baseado em ferramentas previamente curadas.

- Metodologias com estabilidade a longo prazo, alta instalabilidade e parametrização, documentação descritiva e
resultados facilmente exploráveis.

:::

::: {.column width="40%" style="text-align: center;"}
![](./index/figure/fluxo_de_trabalho.png){width=1000}
:::

::::


## O Ecossistema Computacional em Metagenômica {.smaller}

- Podemos agrupar as metodologias da MS em duas grandes categorias: As baseadas em montagem e as livres de montagem;

- As baseadas em montagem são amplas e cobrem os mais diversos aspectos do processamento de dados de MS, mas as livres de montagem são escassas,
sobretudo ao considerarmos boas práticas de desenvolvimento de software científico. Nesse contexto, destaca-se o MEDUSA;

- Há a necessidade de desenvolver uma metodologia para dados de MS que siga boas práticas de desenvolvimento de software científico.

# Objetivo

- Obter uma visão geral do ecossistema computacional em metagenômica atual
e como ele se associa com princípios de desenvolvimento de software científico, desenvolvendo então uma metodologia para dados de MS que possibilite uma análise metagenômica compreensiva, de forma reprodutível e flexível.

# Objetivos específicos

  - Avaliar o atual ferramentário computacional para dados de meta-ômica e sua
adesão a princípios de desenvolvimento de software sustentável.
  - Desenvolver uma metodologia robusta, flexível e acessível para análise de dados
de MS.

# Capítulo I

![](./index/figure/paper1.png)

## Software em meta-ômica possibilitou novas descobertas

- No entanto, esses *softwares* ainda possuem muitos desafios a frente;

- Instalabilidade, acessibilidade ao usuário e portabilidade são desafios não apenas em meta-ômica mas bioinformática como um todo;

- Esses desafios podem ser enfrentados com empacotamento de código, tecnologia de contêiner, curadoria do ferramentário
e orquestradores de fluxo de trabalho;

## A adoção de boas práticas de software em Meta-ômica {.smaller}

- Apesar da computação favorecer reprodutibilidade, ela ainda é negligenciada, devido 
a dificuldades em instalação, execução e documentação;

- O uso de uma única versão de *software*, disponibilizada através de tecnologias de contêineres
como Docker e Singularity aumentam a instalabilidade, a estabilidade a longo prazo e até taxas de citação
do software;

- A utilização de orquestradores de fluxos de trabalho, para análises que envolvem várias ferramentas em sequência,
também se torna indispensável para garantir maior reprodutibilidade, além de facilidades na execução, aumentando também
a acessibilidade ao usuário.

## Avaliação geral {.smaller}

- Não houve ainda uma avaliação da implementação dessas tecnologias em meta-ômica, o que pode apontar 
para uma baixa adoção;

- Ademais, sugerimos que, após uma avaliação de fluxos de trabalho citados em uma revisão de metatranscriptômica,
a aderência a esses princípios é ainda baixa.

![](./index/figure/table_paper1.png){width=500}

## O cenário está mudando {.smaller}

- O uso de tecnologias de orquestração de *pipelines* é crescente, algo evidente 
com o número crescente de citações a artigos que descrevem essas tecnologias, como
Nextflow, Snakemake e Galaxy.

- Apesar disso, avanços têm sido feitos na área de integração de dados meta-ômicos,
com um pipeline Galaxy recente possibilitando uma análise intercomunicável entre 3 fluxos de trabalho. No entanto, ainda há 
preocupações acerca da limitação à infraestrutura do Galaxy e iniciativas semelhantes
ainda não foram vistas em outras plataformas.

## Em conclusão

- *Softwares* para metagenômica e metatranscriptômica precisam ser desenvolvidos com
clareza, reprodutibilidade e reutilização como princípios guiadores.

- A baixa aderência a esses princípios é ainda mais claro ao avaliar o estado do *software*
em metatranscriptômica e integração de dados.

- A adoção dessas diretrizes não só ilustra a qualidade dessas metodologias computacionais,
mas também garante que sejam capazes de suportados a longo prazo.

# Capítulo II

![](./index/figure/paper2.png)

## Fluxos de trabalho para metagenômica

- Podem ser divididos entre: *baseados em montagem* e *livres de montagem*.
  - Entre os baseados em montagem, destacam-se vários que seguem os princípios
  delineados no artigo anterior, como nf-core/mag e Metaphor.

- Entre os livres de montagem, há um destaque no MEDUSA, que realizou uma curadoria
cuidadosa dos softwares a serem incluídos através de um benchmarking de performance e sensitividade.

- No entanto, MEDUSA possuía algumas limitações: Conda, portabilidade, Snakemake, referências estáticas e documentação escassa.

## Introduzindo EURYALE {.smaller}

<center>
![](https://github.com/dalmolingroup/euryale/blob/main/assets/euryale_logo.png?raw=true){width=500}
</center>

- Mais portável, com execução em Docker ou Singularity, e suporte nativo a gerenciadores de lote como SLURM;

- Mais parametrizável, possibilitando o uso opcional de diferentes etapas de análise e se adaptando a diferentes referências.

- Mais acessível, com a geração de relatórios automáticos e interativos que possibilitam uma melhor exploração de dados.

## Metodologia

- Utilizamos o template nf-core, com a linguagem Nextflow, que valoriza boas práticas de desenvolvimento de software e, dentre outras coisas,
possibilita fácil adaptação a diferentes usos de recursos.

- MicroView, ferramenta desenvolvida para o *pipeline* gerar relatórios automatizados de métricas de diversidade,
é feita em Python e depende no Scikit-Bio.

<center>
![](https://raw.githubusercontent.com/nf-core/logos/master/nf-core-logos/nf-core-logo-darkbg.png#gh-dark-mode-only){width=400}

![](https://github.com/nextflow-io/nextflow/raw/master/docs/_static/nextflow-logo-bg-dark.png){width=400}
</center>

---

<center>
![](index/figure/paper2_fig1.png){width=1200}
</center>

::: {.smaller}
- Diagrama ilustrando cada passo do fluxo de trabalho EURYALE, se iniciando com leituras FASTQ como entrada. Círculos são passos habilitados, quadrados passos desabilitados por padrão.

- Diferente do antecessor, o EURYALE possibilita o uso de novas referências, mas com suporte para as referências do MEDUSA através da entrada *download* (`-entry download`).

:::

## Detalhes da implementação

- Nova ferramenta de classificação, Kraken2, visto o suporte que a ferramenta têm obtido no tempo após o desenvolvimento do MEDUSA.

- Exemplo de execução em Docker:

```bash
nextflow run dalmolingroup/euryale \
  --input samplesheet.csv \
  --outdir <output directory> \
  --kaiju_db <kaiju database> \
  --reference_fasta <reference FASTA> \
  --host_fasta <host reference FASTA> \
  --id_mapping <ID mapping file> \
  -profile docker
```

---

![](index/figure/euryale_entries.drawio.png)

- Diagrama ilustrando como a entrada de download do EURYALE adquire
os bancos de dados que alimentam a entrada principal. Com uma análise
típica do zero sendo constituída por ambas etapas.

---

:::: {.columns}

::: {.column width="50%"}
### Relatório automatizados

- Além das visualizações Krona para cada amostra, também implementamos MultiQC e MicroView no EURYALE.

- Figura incluída como parte do relatório MultiQC do EURYALE. A: Figura da etapa de controle de qualidade; B: Figura da etapa de classificação taxonômica.

:::

::: {.column width="40%" style="text-align: center;"}
![](index/figure/paper2_fig2.png)
:::

::::

## Relatórios automatizados {.smaller}

<center>
![](index/figure/paper2_fig3.png)
</center>

- Figura incluída como parte do relatório MicroView do EURYALE. Um gráfico de dispersão interativo de Equabilidade de Pielou e diversidade de Shannon.

- O MicroView também gera visualizações da diversidade Bray-Curtis e abundâncias relativas de cada táxon em cada amostra.

- Também pode ser executado de forma isolada fora do *pipeline*.

--- 

![](index/figure/multiqc_example.png)

- Exemplo do cabeçalho de um relatório gerado através da ferramenta MultiQC, 
implementada como parte integrante do EURYALE.

--- 

![](index/figure/microview_example.png)
- Exemplo do cabeçalho de um relatório gerado através da ferramenta Microview, 
escrita em Python e implementada como parte integrante do EURYALE.

---

![](index/figure/seqera_platform_example.png){width=900}

- Porção inicial da interface gráfica do EURYALE na Seqera Platform
(<https://cloud.seqera.io/>).

# Discussão

- Averiguamos limitações na adoção de boas práticas em fluxos de trabalho em meta-ômica;

- Aplicamos os príncipios postos a uma metodologia, construída através de rigoroso *benchmarking*, MEDUSA;

- Através disso, construímos o EURYALE:
  - Maior parametrização;
  - Documentação descritiva;
  - Maior acessibilidade de dados.

# Conclusões

- Observamos uma baixa aderência a boas práticas de desenvolvimento, sobretudo no
que tange pipelines de análise de dados;

- Desenvolvemos o EURYALE, que possibilita uma análise completa de dados de MS e adere aos princípios já citados.
  - EURYALE se aproveita da sensitividade e cuidadosa curadoria ferramental do seu antecessor;
  - Melhora em termos de parametrização, suporte a longo prazo, adaptabilidade a diferentes contextos e acessibilidade de dados.

- No entanto, metodologias de integração de dados meta-ômicos que sigam as boas práticas ainda são escassos.


<!-- # Referências {.scrollable} -->

<!-- ::: {#refs} -->
<!-- ::: -->

# O Ecossistema Computacional da Metagenômica {style="text-align: center;"}

Fluxos de Trabalho e Reprodutibilidade

João Vitor Cavalcante
